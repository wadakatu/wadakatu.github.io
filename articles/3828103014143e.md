---
title: "ã€Inertia.jsã€‘[object Object] could not be cloned.ã®å¯¾å‡¦æ³•"
emoji: "ğŸ˜"
type: "tech"
topics:
  - "javascript"
  - "laravel"
  - "inertia"
  - "channeltalk"
published: true
published_at: "2023-01-06 14:40"
---

## èƒŒæ™¯

Laravel + Inertia.js + Vue3ã§SPAé–‹ç™ºã‚’è¡Œãªã£ã¦ã„ã¾ã—ãŸã€‚
ãã—ã¦ã€ãƒãƒ£ãƒãƒ«ãƒˆãƒ¼ã‚¯ã®SPAç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆå°å…¥ã‚’è¡Œãªã£ãŸã¨ã“ã‚ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿã—ã¾ã—ãŸã€‚

https://developers.channel.io/docs/web-installation#single-page-application

## å®Ÿè£…
ãƒãƒ£ãƒãƒ«ãƒˆãƒ¼ã‚¯ã®èµ·å‹•ã«ã¯ã€PluginKeyãŒå¿…é ˆã§ã™ã€‚
shareInertiaData.phpã‹ã‚‰usePageé–¢æ•°çµŒç”±ã§PluginKeyã‚’å–å¾—ã—ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚

```php:shareInertiaData.php
public function handle(Request $request, callable $next)
{
    Inertia::share(['channelTalk' => [
        'pluginKey' => 'my-plugin-key',
    ]]);

    return $next($request);
}
```

```js:channel-talk.js
const page = usePage();

if (page.props.value.channelTalk) {
ã€€ã€€ã€€ã€€// ãƒãƒ£ãƒãƒ«ãƒˆãƒ¼ã‚¯èµ·å‹•
  ChannelService.boot(page.props.value.channelTalk);
}
```

## ã‚¨ãƒ©ãƒ¼
usePageé–¢æ•°ã‹ã‚‰å–å¾—ã—ãŸPluginKeyã‚’ãã®ã¾ã¾`ChannelService.boot`é–¢æ•°ã®å¼•æ•°ã«æ¸¡ã™ã¨ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

```
Uncaught DOMException: Failed to execute 'structuredClone' on 'Window': [object Object] could not be cloned.
```

## åŸå› 

inertia.jsã®usePage()é–¢æ•°ã‹ã‚‰å–å¾—ã§ãã‚‹Proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãã®ã¾ã¾ä½¿ã£ã¦ã„ãŸã®ãŒåŸå› ã§ã—ãŸã€‚

inertia.jsã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚‚ä¼¼ãŸã‚ˆã†ãªç¾è±¡ãŒå ±å‘Šã•ã‚Œã¦ã„ãŸã€‚
https://github.com/inertiajs/inertia/issues/775

## è§£æ±ºç­–

**JSON.parseé–¢æ•°ã¨JSON.stringifyé–¢æ•°**ã‚’ä½¿ã„ã€Proxyã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å¤‰æ›ã™ã‚‹ã€‚

```js:ä¾‹ 
JSON.parse(JSON.stringify(usePage().props));
```

ä¸‹è¨˜ã®ã‚ˆã†ã«å®Ÿè£…ã‚’ä¿®æ­£ã™ã‚Œã°ã€ç§ã®ã‚¨ãƒ©ãƒ¼ã‚‚ç„¡äº‹æ¶ˆãˆã¾ã—ãŸã€‚

```diff js:channel-talk.js
const page = usePage();

if (page.props.value.channelTalk) {
ã€€ã€€ã€€ã€€// ãƒãƒ£ãƒãƒ«ãƒˆãƒ¼ã‚¯èµ·å‹• 
- ChannelService.boot(page.props.value.channelTalk);
+ ChannelService.boot(JSON.parse(JSON.stringify(page.props.value.channelTalk)));
}
```